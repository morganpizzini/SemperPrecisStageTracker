@page "/"
@inherits SemperPrecisBaseComponent
@inject IStringLocalizer<Home> L
@inject StateService stateService

<Row>
    <Column ColumnSize="ColumnSize.Is6.OnDesktop.IsFull.OnTablet">
            <Card Margin="Margin.Is4.OnY">
                <CardBody>
                    <CardTitle>
                        @L["MatchRegistration"]
                    </CardTitle>
                    
                    <ShooterInGroup SubmitCallback="Submit" Model="model" Shooter="stateService.User" AvailableMatches="AvailableMatches"></ShooterInGroup>
                </CardBody>
            </Card>
    </Column>
</Row>

@code
{
    Validations validations;
    IList<MatchContract> AvailableMatches = new List<MatchContract>();

    BaseShooterInMatchCreateRequest model = new();
    protected override async Task OnInitializedAsync()
    {
        var result = await Post<IList<MatchContract>>("api/Match/FetchAvailableMatches");

        if (result != null)
            AvailableMatches = result;

        await base.OnInitializedAsync();
    }
    async Task Submit()
    {
        if (!(await validations.ValidateAll()))
            return;

        await validations.ClearAll();
        
        var request = new MatchShooterCreateRequest()
        {
            ShooterId = model.ShooterId,
            DivisionId = model.DivisionId,
            TeamId = model.TeamId,
            MatchId = model.MatchId
        };

        //var result = await Post<IList<GroupShooterContract>>("/api/GroupShooter/AddGroupShooter", request);
        
    }
}
